jQuery(document).ready(function ($) {
  $("#start-scan").click(function () {
    $("#scan-progress").css("width", "0%").text("0%");
    $(".progress").show();
    $("#scan-results").hide();

    $.ajax({
      url: wp_malware_scanner.ajax_url,
      type: "POST",
      data: {
        action: "run_wp_malware_scan",
        nonce: wp_malware_scanner.nonce,
      },
      success: function (response) {
        $("#scan-progress").css("width", "100%").text("100%");

        let scanResults = response.data.message;

        // Format the scan results with line breaks and HTML for readability
        scanResults = scanResults.replace(/\n/g, "<br>");

        $("#scan-results")
          .html("<strong>Scan Complete:</strong><br>" + scanResults)
          .show();
      },
      error: function () {
        $("#scan-results")
          .html("<strong>Error:</strong> Something went wrong during the scan.")
          .show();
      },
    });
  });
});
